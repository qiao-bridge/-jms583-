//SSD1315
//=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=

#include <at89x51.h>
//#include <reg52.h>
#include <intrins.h>

#define Uchar unsigned char
#define Uint  unsigned int
#define Ulong unsigned long
#define uchar unsigned char
#define uint  unsigned int

//-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=
//  Pin Definition
//-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=

//0.49
#define SCL3	P3_1				// Serial Clock Input
#define SDA3	P3_2				// Serial Data Input
#define RES		P3_3
code PicData1[]={
/*--图像:宽度x高度=64x32  --*/
0xFF,0x01,0xF1,0x09,0x05,0x05,0x05,0x09,0xF1,0x01,0x05,0xFD,0x05,0x01,0x01,0x01,
0x01,0x05,0xFD,0x25,0x75,0x05,0x0D,0x01,0x05,0xFD,0x05,0x05,0x05,0x09,0xF1,0x01,
0xF9,0x05,0x05,0x05,0xF9,0x01,0x01,0x01,0x01,0xC1,0xB1,0x89,0xFD,0x81,0x01,0x39,
0x45,0x45,0xC5,0x79,0x01,0x1D,0x01,0x1D,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0xFF,
0xFF,0x00,0x00,0x81,0x62,0xA2,0x92,0x11,0x00,0x00,0xC2,0x23,0xF2,0x02,0x02,0x83,
0x80,0x02,0x83,0x82,0x02,0x22,0x13,0x90,0x92,0x63,0x02,0x22,0x12,0x11,0x10,0xE0,
0x01,0x02,0x02,0x02,0x11,0xF0,0x10,0x02,0x10,0xF0,0x10,0x00,0xC3,0x20,0x10,0x12,
0x12,0x31,0x01,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,
0xFF,0x00,0x80,0x47,0x49,0x48,0x88,0x07,0x40,0xC3,0x02,0x02,0x0F,0x82,0x40,0x48,
0x4D,0x82,0x0D,0x08,0x00,0x08,0x08,0x48,0xC8,0x07,0x00,0x08,0x0C,0x0A,0x09,0x0C,
0x00,0x00,0x00,0x00,0x08,0xCF,0x08,0x00,0x08,0x0F,0x48,0xC0,0x43,0x44,0x48,0x88,
0x08,0x04,0x80,0x40,0x40,0x40,0xC0,0x00,0xC0,0x40,0x40,0x40,0xC0,0x40,0x00,0xFF,
0xFF,0x80,0x9F,0xA0,0xA0,0xA0,0x9F,0x80,0xA0,0xBF,0xA0,0x80,0x80,0xA0,0xB0,0xA8,
0xA4,0xB3,0x80,0x90,0xAA,0xAA,0xBC,0xA0,0x9F,0xA2,0xA2,0x9C,0x80,0x9C,0xA2,0xA2,
0xA6,0x80,0xA0,0xB8,0xAF,0x88,0xAF,0xB8,0xA0,0x80,0xA0,0xBF,0xA2,0xA2,0xA2,0x9D,
0x80,0x8F,0x90,0xA0,0xA0,0xA0,0x90,0x80,0xB0,0xA8,0xA6,0xA1,0xA0,0xB0,0x80,0xFF,
};

//-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=

void 	delay_ms(Uint t)
{
	Uchar i,j;
	while(--t)
	{
	i=50;	
	j=100;

		while(--j)
			while(--i);
	}
}

void uDelay(Uchar l)
{
	while(l--);
}


//****************************************************************************
//-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=
//  Read/Write Sequence
//-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=
void I2C_3(Uchar mcmd)
{
Uchar length = 8;			// Send Command

	while(length--)
	{
		if(mcmd & 0x80)
		{
			SDA3=1;
		}
		else
		{
			SDA3=0;
		}
		// uDelay(1);
		SCL3=1;
		// uDelay(1);
		SCL3=0;
		// uDelay(1);
		mcmd = mcmd << 1;
	}
}

void I2C_Ack3()
{
	SDA3=1;
	uDelay(1);
	SCL3=1;
	uDelay(1);
	SCL3=0;
	uDelay(1);
}

void I2C_NAck3()
{
	SDA3=0;
	uDelay(1);
	SCL3=1;
	uDelay(1);
	SCL3=0;
	uDelay(1);
}

void I2C_Start3()
{
	SDA3=0;
	uDelay(1);
	SCL3=1;
	uDelay(1);
	SCL3=0;
	uDelay(1);
	I2C_3(0x78);
	I2C_Ack3();
}

void I2C_Stop3()
{
	SCL3=1;
	uDelay(1);
	SDA3=0;
	uDelay(1);
	SDA3=1;
	uDelay(1);
}

void Write_Command3(Uchar Data)
{
	I2C_Start3();
	I2C_3(0x00);
	I2C_Ack3();
	I2C_3(Data);
	I2C_Ack3();
	I2C_Stop3();
}

void Write_Data3(Uchar Data)
{
	I2C_Start3();
	I2C_3(0x40);
	I2C_Ack3();
	I2C_3(Data);
	I2C_Ack3();
	I2C_Stop3();
}
//-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=

void Column_set(unsigned char column)
{
	Write_Command3(0x10|(column>>4));
	Write_Command3(0x00|(column&0x0f));	 
}
void Page_set(unsigned char page)
{
	Write_Command3(0xb0+page);
}
//-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=
void Pic1(void)
{
	Uchar i,j;
	Uint k;
	k=0;
	for(j=0;j<4;j++)
	{
		Page_set(j);
		Column_set(32);
 		for(i=32;i<96;i++)		  				//显示单色数据到LCD
		{
			Write_Data3(PicData1[k]);
			k=k+1;
		
		}
	}
}

void fill(Uchar Data)
{
	Uchar i,j;
	Uint k;
	k=0;
	for(j=0;j<4;j++)
	{
		Page_set(j);
		Column_set(32);
 		for(i=32;i<96;i++)		  				//显示单色数据到LCD
		{
			Write_Data3(Data);
			k=k+1;
		
		}
	}
}

//-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=
void	LCD_Init3(void)
{
RES=0; 
delay_ms(10);
RES=1; 
delay_ms(5);
 
Write_Command3(0xae);	//--turn off oled panel

Write_Command3(0xd5);	//--set display clock divide ratio/oscillator frequency
Write_Command3(0x80);	//--set divide ratio

Write_Command3(0xa8);	//--set multiples ratio(1to64)
Write_Command3(0x1f);	//--1/32 duty

Write_Command3(0xd3);	//--set display offset
Write_Command3(0x00);	//--not offset

Write_Command3(0x40);	//--set Display start line

Write_Command3(0x8d);	//--set chare pump
Write_Command3(0x14);	//--set(0x10) disable

Write_Command3(0xa1);	//--set segment re-map 127 to 0   a0:0 to seg127
Write_Command3(0xc8);	//--set com(N-1)to com0  c0:com0 to com(N-1)

Write_Command3(0xda);	//--set com pins hardware configuration
Write_Command3(0x12);

Write_Command3(0x81);	//--set contrast control register
Write_Command3(0xff);	//0x4f

Write_Command3(0xd9);	//--set pre-charge period
Write_Command3(0x22);	//0x1f,0xf1

Write_Command3(0xdb);	//--set vcomh
Write_Command3(0x20);//0x40

Write_Command3(0xa4);	//--set Entire Display on/off

fill(0x00);//清屏
delay_ms(1);

Write_Command3(0xaf);	//--turn on oled panel
delay_ms(1);
}
//-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=void 	LCD_Init(void)
void main()
{

	LCD_Init3();

	while(1)

	{
		fill(0x00);
		delay_ms(8);   
		fill(0xff);
		delay_ms(8);
		Pic1();
		delay_ms(8);
	}
}
